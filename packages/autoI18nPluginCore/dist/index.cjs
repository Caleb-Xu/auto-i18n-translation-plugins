"use strict";var t=require("@vitalets/google-translate-api"),n=require("tunnel"),e=require("axios"),o=require("crypto-js"),r=require("@babel/types"),i=require("node:fs"),a=require("node:path");function c(t){var n=Object.create(null);return t&&Object.keys(t).forEach((function(e){if("default"!==e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})}})),n.default=t,Object.freeze(n)}var s=c(r),l=function(t,n){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},l(t,n)};function u(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}l(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var p,f,g=function(){return g=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},g.apply(this,arguments)};function h(t,n,e,o){return new(e||(e=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,c)}s((o=o.apply(t,n||[])).next())}))}function d(t,n){var e,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(e=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(t,a)}catch(t){c=[6,t],o=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}function v(t,n,e){if(e||2===arguments.length)for(var o,r=0,i=n.length;r<i;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return t.concat(o||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError,function(t){t.ZH="zh-cn",t.EN="en"}(p||(p={})),function(t){t.google="Google",t.youdao="Youdao"}(f||(f={}));var y,x=function(){function t(t,n,e){this.queue=[],this.isRunning=!1,this.fn=t,this.delay=n,this.timeout=e}return t.prototype.execute=function(){for(var t=this,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return new Promise((function(e,o){t.queue.push({args:n,resolve:e,reject:o}),t.run(),t.timeout&&setTimeout((function(){o(new Error("IntervalQueue timeout"))}),t.timeout)}))},t.prototype.wait=function(){return h(this,arguments,void 0,(function(t){return void 0===t&&(t=this.delay),d(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){return setTimeout(n,t)}))];case 1:return n.sent(),[2]}}))}))},t.prototype.run=function(){return h(this,void 0,void 0,(function(){var t,n,e,o,r,i;return d(this,(function(a){switch(a.label){case 0:if(this.isRunning)return[2];a.label=1;case 1:if(!(t=this.queue.shift()))return[3,7];n=t.args,e=t.resolve,o=t.reject,this.isRunning=!0,a.label=2;case 2:return a.trys.push([2,4,,5]),r=e,[4,this.fn.apply(this,n)];case 3:return r.apply(void 0,[a.sent()]),[3,5];case 4:return i=a.sent(),o(i),[3,5];case 5:return[4,this.wait()];case 6:return a.sent(),[3,1];case 7:return this.isRunning=!1,[2]}}))}))},t}(),b=function(){function t(t){var n,e,o;this.option=t,this.option.interval&&(this.option.fetchMethod=(n=this.option.fetchMethod,e=this.option.interval,o=new x(n.bind(null),e),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return o.execute.apply(o,t)}))}return t.prototype.getErrorMessage=function(t){return t instanceof Error?t.message:String(t)},t.prototype.translate=function(t,n,e){return h(this,void 0,void 0,(function(){var o,r,i;return d(this,(function(a){switch(a.label){case 0:o="",a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.option.fetchMethod(t,n,e)];case 2:return o=a.sent(),[3,4];case 3:return r=a.sent(),i=this.option.name,console.error("翻译api".concat(i?"【".concat(i,"】"):"","请求异常：").concat(this.getErrorMessage(r))),[3,4];case 4:return[2,o]}}))}))},t}(),O=function(e){function o(o){var r=e.call(this,{name:"Google翻译",fetchMethod:function(e,i,a){return h(r,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,t.translate(e,{from:i,to:a,fetchOptions:{agent:n.httpsOverHttp({proxy:o.proxyOption})}})];case 1:return[2,r.sent().text||""]}}))}))}})||this;return r}return u(o,e),o}(b),j=function(t){function n(n){var r,i=t.call(this,{name:"有道翻译",fetchMethod:function(t,r,a){return h(i,void 0,void 0,(function(){var i,c,s,l,u,p,f;return d(this,(function(g){switch(g.label){case 0:return i=(new Date).getTime(),c=Math.round((new Date).getTime()/1e3),s=n.appId+this.truncate(t)+i+c+n.appKey,l=o.SHA256(s).toString(o.enc.Hex),u={q:t,appKey:n.appId,salt:i,from:this.getTranslateKey(r),to:this.getTranslateKey(a),sign:l,signType:"v3",curtime:c},[4,e.post("https://openapi.youdao.com/api",u,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},proxy:n.proxy})];case 1:return p=g.sent(),[2,(null===(f=p.data.translation)||void 0===f?void 0:f[0])||""]}}))}))},interval:null!==(r=n.interval)&&void 0!==r?r:1e3})||this;return i.YOUDAO_TRANSLATE_KEY_CONVERT_MAP={"zh-cn":"zh-CHS","zh-tw":"zh-CHT"},i}return u(n,t),n.prototype.truncate=function(t){if(t.length<=20)return t;var n=t.length;return t.substring(0,10)+n+t.substring(n-10)},n.prototype.getTranslateKey=function(t){return this.YOUDAO_TRANSLATE_KEY_CONVERT_MAP[t]||t},n}(b),S=Object.freeze({__proto__:null,GoogleTranslator:O,Translator:b,YoudaoTranslator:j}),w=function(){function t(){}return t.originLang="",t}(),m=((y={})[p.ZH]=/[\u4e00-\u9fff]/,y[p.EN]=/[a-zA-Z]/,y);function E(t){var n=w.originLang;return m[n].test(t)}function L(t,n){for(var e=0;e<n.length;e++){if(("string"==typeof n[e]?new RegExp(n[e]):n[e]).test(t))return!0}return!1}function T(t){var n="";return r.isCallExpression(t)&&(n=r.isMemberExpression(t.callee)?function t(n,e){return e+="."+n.property.name,r.isMemberExpression(n.object)?t(n.object,e):e=n.object.name+e}(t.callee,""):t.callee.name||""),n}function _(t,n){var e=t.match(n);return e?e.filter((function(t,n){return e.indexOf(t)===n})):[]}function k(t,n,e){var o=exports.option.namespace,i=t.trim(),a=i.replace(/'/g,'"').replace(/(\n)/g,"\\n"),c=e||P(a);if(n){var s=r.stringLiteral(i);return s.extra={raw:"'".concat(a,"'"),rawValue:i},r.callExpression(r.identifier(exports.option.translateKey),[r.stringLiteral(c),s,r.stringLiteral(o)])}return"".concat(exports.option.translateKey,"('").concat(c,"','").concat(a,"','").concat(o,"')")}function P(t){for(var n=0,e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n|=0}return Math.abs(n).toString(36)+t.length.toString(36)}var N=function(t){return t.replace(/\\u[\dA-Fa-f]{4}/g,(function(t){return String.fromCharCode(parseInt(t.replace(/\\u/g,""),16))}))};function A(t,n){if(void 0===n&&(n=new WeakMap),"object"!=typeof t||null===t)return t;if(n.has(t))return n.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t.source,t.flags);var e=Array.isArray(t)?[]:{};n.set(t,e);for(var o=0,r=v(v([],Object.keys(t),!0),Object.getOwnPropertySymbols(t).filter((function(n){return t.propertyIsEnumerable(n)})),!0);o<r.length;o++){var i=r[o];e[i]=A(t[i],n)}return e}var J=Object.freeze({__proto__:null,checkAgainstRegexArray:L,cloneDeep:A,createI18nTranslator:k,extractCnStrings:function(t){return _(t,/[^\x00-\xff]+/g)},extractFunctionName:T,extractStrings:_,generateId:P,hasOriginSymbols:E,removeComments:function(t){return t=(t=(t=t.replace(/\/\/.*?\n/g,"")).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/<!--[\s\S]*?-->/g,"")},truncate:function(t){if(t.length<=20)return t;var n=t.length;return t.substring(0,10)+n+t.substring(n-10)},unicodeToChinese:N}),K={translateKey:"$t",excludedCall:["$i8n","require","$$i8n","console.log","$t"],excludedPattern:[/\.\w+$/],excludedPath:["node_modules"],includePath:[/src\//],globalPath:"./lang",distPath:"",distKey:"index",originLang:p.ZH,targetLangList:["en"],langKey:[],namespace:"",buildToDist:!1,translator:new O({proxyOption:{port:7890,host:"127.0.0.1",headers:{"User-Agent":"Node"}}}),translatorOption:void 0};exports.option=g({},K);var C={tab:{char:"\t",size:1},space:{char:" ",size:4}},z={type:"tab"},F=[],R=function(t){return"\\".concat(F.push(t),"\\")},M=function(t,n){return F[+n-1]},D=function(t,n){return new Array(t+1).join(n)};function q(t,n){void 0===n&&(n=z);var e="string"==typeof t?t:JSON.stringify(t),o=C[n.type];if(!o)throw new Error('Unrecognized indent type: "'.concat(n.type,'"'));return function(t,n){F=[];var e="",o=0;t=t.replace(/\\./g,R).replace(/(".*?"|'.*?')/g,R).replace(/\s+/g,"");for(var r=0;r<t.length;r++){var i=t.charAt(r);switch(i){case"{":case"[":e+=i+"\n"+D(++o,n);break;case"}":case"]":e+="\n"+D(--o,n)+i;break;case",":e+=",\n"+D(o,n);break;case":":e+=": ";break;default:e+=i}}return e.replace(/\[[\d,\s]+?\]/g,(function(t){return t.replace(/\s/g,"")})).replace(/\\(\d+)\\/g,M).replace(/\\(\d+)\\/g,M)}(e,D(n.size||o.size,o.char))}function I(){var t=exports.option.translateKey,n="(function () {\n    let ".concat(t," = function (key, val, nameSpace) {\n      const langPackage = ").concat(t,"[nameSpace]\n      return (langPackage || {})[key] || val;\n    };\n    let $").concat(t," = function (val) {\n      return val;\n    };\n    ").concat(t,".locale = function (locale, nameSpace) {\n      ").concat(t,"[nameSpace] = locale || {};\n    };\n    window.").concat(t," = window.").concat(t," || ").concat(t,";\n    window.$").concat(t," = $").concat(t,";\n    window._getJSONKey = function (key, insertJSONObj = undefined) {\n      const JSONObj = insertJSONObj\n      const langObj = {}\n      Object.keys(JSONObj).forEach((value)=>{\n        langObj[value] = JSONObj[value][key]\n      })\n      return langObj\n    }\n  })();"),e=a.join(exports.option.globalPath,"index.js");i.existsSync(e)||i.writeFileSync(e,n)}function $(){var t=a.join(exports.option.globalPath,"index.json");i.existsSync(t)||i.writeFileSync(t,JSON.stringify({}))}function H(){var t=a.join(exports.option.globalPath,"index.json");try{return i.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?console.log("❌读取JSON配置文件异常，文件不存在"):console.log("❌读取JSON配置文件异常，无法读取文件"),JSON.stringify({})}}function U(t,n){void 0===n&&(n=void 0);var e=n||JSON.parse(H()),o={};return Object.keys(e).forEach((function(n){o[n]=e[n][t]})),o}function W(t){var n=a.join(exports.option.globalPath,"index.json"),e=q(t);i.existsSync(n)?i.writeFileSync(n,e):console.log("❌JSON配置文件写入异常，文件不存在")}var Y=Object.freeze({__proto__:null,buildSetLangConfigToIndexFile:function(){if(exports.option.buildToDist){var t={};exports.option.langKey.forEach((function(n){t[n]=U(n)})),i.existsSync(exports.option.distPath)&&i.readdir(exports.option.distPath,(function(n,e){n?console.error("❌构建文件夹为空，翻译配置无法写入"):e.forEach((function(n){if(n.startsWith(exports.option.distKey)&&n.endsWith(".js")){var e=a.join(exports.option.distPath,n);i.readFile(e,"utf-8",(function(n,o){if(n)return console.log(e),void console.error("❌构建主文件不存在，翻译配置无法写入");var r="";Object.keys(t).forEach((function(n){r+="window['".concat(exports.option.namespace,"']['").concat(n,"']=").concat(JSON.stringify(t[n]),";")}));try{i.writeFileSync(e,"window['".concat(exports.option.namespace,"']={};").concat(r)+o),console.info("恭喜：翻译配置写入构建主文件成功🌟🌟🌟")}catch(n){console.error("翻译配置写入构建主文件失败:",n)}}))}}))}))}},getLangObjByJSONFileWithLangKey:U,getLangTranslateJSONFile:H,initLangFile:function(){i.existsSync(exports.option.globalPath)||i.mkdirSync(exports.option.globalPath),$(),I()},initLangTranslateJSONFile:$,initTranslateBasicFnFile:I,setLangTranslateJSONFile:W}),G="\n┇┇┇\n",X=/\n┇ *┇ *┇\n/,Z={};function V(t,n){Z[t]||(Z[t]=n)}function B(){return Z}function Q(t,n,e){return h(this,void 0,void 0,(function(){var o,r,i,a,c,s;return d(this,(function(l){switch(l.label){case 0:return o={},Object.keys(t).forEach((function(e){n[e]||(o[e]=t[e])})),Object.values(o).length?(r=Object.values(o).join(G),console.info("进入新增语言补全翻译..."),[4,exports.option.translator.translate(r,exports.option.originLang,e)]):[2];case 1:if(i=l.sent(),(a=i.split(X).map((function(t){return t.trim()}))).length!==Object.values(t).length)return console.error("翻译异常，翻译结果缺失❌"),[2];c=a,console.info("翻译成功⭐️⭐️⭐️"),Object.keys(o).forEach((function(t,e){n[t]=c[e]})),console.log("开始写入JSON配置文件..."),s=JSON.parse(H()),Object.keys(o).forEach((function(t){s[t][e]=n[t]}));try{W(s),console.info("JSON配置文件写入成功⭐️⭐️⭐️")}catch(t){console.error("❌JSON配置文件写入失败"+t)}return console.info("新增语言翻译补全成功⭐️⭐️⭐️"),[2]}}))}))}var tt=Object.freeze({__proto__:null,SEPARATOR:G,SPLIT_SEPARATOR_REGEX:X,autoTranslate:function(){return h(this,void 0,void 0,(function(){var t,n,e,o,r,i,a,c,s,l,u,p;return d(this,(function(f){switch(f.label){case 0:if(t={},exports.option.langKey.forEach((function(n){t[n]=U(n)})),n=JSON.parse(JSON.stringify(B())),e={},Object.keys(n).forEach((function(o){t[exports.option.originLang][o]||(e[o]=n[o])})),0===Object.keys(e).length)return console.info("✅ 当前没有需要翻译的新内容"),[2];o={},r=0,f.label=1;case 1:if(!(r<exports.option.langKey.length))return[3,4];if(i=exports.option.langKey[r],0===r)return o[exports.option.originLang]=Object.values(e),[3,3];for(console.info("开始自动翻译..."),a=function(t,n){void 0===n&&(n=4500);for(var e=G.length,o=[],r=[],i=0,a=function(){if(r.length>0){var t=r.join(G).length;t>n&&console.warn("缓冲区提交异常：生成块长度 ".concat(t," 超过限制")),o.push(r.join(G)),r=[],i=0}},c=0,s=t;c<s.length;c++){var l=s[c],u=l.length+(r.length>0?e:0);l.length>n?(r.length>0&&a(),l.length>1.5*n&&console.warn("超长文本告警：检测到长度 ".concat(l.length," 字符的文本项，可能影响翻译质量")),o.push(l)):(i+u>n&&a(),i+=u,r.push(l))}return a(),o}(Object.values(e)),c=[],s=0;s<a.length;s++)c.push(exports.option.translator.translate(a[s],exports.option.originLang,exports.option.langKey[r]));return[4,Promise.all(c)];case 2:if(l=f.sent(),(u=l.map((function(t){return t.split(X).map((function(t){return t.trim()}))})).flat()).length!==Object.keys(e).length)return console.error("❌ 翻译结果不完整\n                预期数量: ".concat(Object.keys(e).length,"\n                实际数量: ").concat(u.length,"\n                样例数据: ").concat(JSON.stringify(u.slice(0,3)))),[2];o[i]=u,console.info("✅ ".concat(i," 翻译完成")),f.label=3;case 3:return r++,[3,1];case 4:Object.keys(e).forEach((function(n,e){exports.option.langKey.forEach((function(r){t[r][n]=o[r][e]}))})),console.log("📄 构建配置文件数据结构..."),p={},Object.keys(t[exports.option.originLang]).forEach((function(n){p[n]={},exports.option.langKey.forEach((function(e){p[n][e]=t[e][n]}))}));try{W(p),console.info("🎉 多语言配置文件已成功更新")}catch(t){console.error("❌ 配置文件写入失败，原因:",t)}return[2]}}))}))},completionTranslateAndWriteConfigFile:Q,getLangObj:B,initLangObj:function(t){Object.keys(Z)||(Z=t)},get langObj(){return Z},languageConfigCompletion:function(t){var n=this;if(Object.keys(t)){var e=[],o=JSON.parse(H());exports.option.targetLangList.forEach((function(t){var n=U(t,o);e.push({key:t,curLangObj:n})})),e.forEach((function(e){return h(n,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,Q(t,e.curLangObj,e.key)];case 1:return n.sent(),[2]}}))}))}))}},setLangObj:V});function nt(t){var n=t.node,e=t.parent,o=n.value;if(exports.option.originLang.includes("zh-cn")||"zh-cn"===exports.option.originLang)try{o=N(o)}catch(t){console.log("转换异常")}if(E(o)&&exports.option.excludedPattern.length&&!L(o,v([],exports.option.excludedPattern,!0))){var r=T(e);if(s.isImportDeclaration(e)||e.key===n||s.isCallExpression(e)&&r&&exports.option.excludedCall.includes(r))return;var i=void 0;if(s.isJSXAttribute(e)){var a=k(o,!0);i=s.jSXExpressionContainer(a)}else i=k(o,!0);t.replaceWith(i)}}function et(t){var n,e,o=t.node;if(o.callee.name===exports.option.translateKey){var i=o.arguments||[],a=(null===(n=i[0])||void 0===n?void 0:n.value)||"",c=(null===(e=i[1])||void 0===e?void 0:e.value)||"";a&&c&&r.isStringLiteral(i[1])&&V(a,c)}}function ot(t){var n=t.node,e=t.parent;if(n.value){var o=n.value.raw||n.value.cooked;if(exports.option.originLang.includes("zh-cn")||"zh-cn"===exports.option.originLang)try{o=N(o)}catch(t){console.log("转换异常")}if(o&&E(o)&&exports.option.excludedPattern.length&&!L(o,v([],exports.option.excludedPattern,!0))){var i=T(e);if(r.isCallExpression(e)&&i&&exports.option.excludedCall.includes(i))return;var a=k(o);n.value.raw=n.value.cooked="${".concat(a,"}");var c=P(o);c&&o&&V(c,o)}}}function rt(t){console.log("jsx text");var n=t.node.value;if(exports.option.originLang.includes("zh-cn")||"zh-cn"===exports.option.originLang)try{n=N(n)}catch(t){console.log("转换异常")}if(E(n)&&exports.option.excludedPattern.length&&!L(n,v([],exports.option.excludedPattern,!0))){var e=k(n,!0),o=s.jSXExpressionContainer(e);t.replaceWith(o)}}var it=Object.freeze({__proto__:null,default:function(){return{visitor:{StringLiteral:nt,JSXText:rt,TemplateElement:ot,CallExpression:et}}}});exports.FunctionFactoryOption=w,exports.GoogleTranslator=O,exports.Translator=b,exports.YoudaoTranslator=j,exports.baseUtils=J,exports.checkOption=function(){return exports.option.translateKey?exports.option.namespace?exports.option.buildToDist&&!exports.option.distKey?(console.log("❌请配置打包后生成文件的主文件名称"),!1):exports.option.buildToDist&&!exports.option.distPath?(console.log("❌请配置打包后生成文件的位置"),!1):exports.option.originLang?!(!exports.option.targetLangList||!exports.option.targetLangList.length)||(console.error("❌请配置目标翻译语言数组"),!1):(console.error("❌请配置来源语言"),!1):(console.error("❌请配置命名空间"),!1):(console.error("❌请配置翻译调用函数"),!1)},exports.fileUtils=Y,exports.filter=it,exports.initOption=function(t){exports.option=g(g({},K),function(t){var n,e=A(t.option);return e.translator=null===(n=null==t?void 0:t.option)||void 0===n?void 0:n.translator,e.translator||(e.translator=e.translatorOption?new b(e.translatorOption):void 0),e.translator||delete e.translator,e}(t)),exports.option.langKey=v([exports.option.originLang],exports.option.targetLangList,!0)},exports.translateUtils=tt,exports.translator=S;
//# sourceMappingURL=index.cjs.map
